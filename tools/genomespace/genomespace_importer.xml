<?xml version="1.0"?>
<tool name="GenomeSpace Importer" id="genomespace_importer" require_login="False" version="0.0.4">
    <description> - receive data from GenomeSpace</description>
    <command>genomespace
        #set $input_file = $genomespace_browser.split("^")[0]
        #set $token = $genomespace_browser.split("^")[1] or $__user__.preferences.get( 'genomespace_token', None )

        #assert $input_file, Exception( 'You must select a valid input file.' )
        #assert $token, Exception( 'Invalid token. You must be logged into GenomeSpace through OpenID or select a valid file via the GenomeSpace browse dialog.' )
        #import binascii
        --token "${ binascii.hexlify(str(token).encode('utf-8')) }"
        encoded_cp "${ binascii.hexlify(str($input_file).encode('utf-8')) }" "${ binascii.hexlify(str($output_file1).encode('utf-8')) }"
    </command>
    <!-- If using this tool through bioblend, the genomespace_browser parameter should contain the path to the GenomeSpaceFile + the security token
         separated by a ^ as follows: GenomeSpaceFilePath^Token -->
    <inputs check_values="False">
        <param name="genomespace_browser" type="genomespacefile" label="Choose Input File from GenomeSpace" select_type="FILE" />
    </inputs>
    <outputs>
        <data format="input" name="output_file1" />
    </outputs>
    <help>
This tool allows you to import data from GenomeSpace. Click the Browse button to select a file to import. The tool will automatically
fetch your GenomeSpace token when you select a file from the import dialog.

Alternatively, you can be logged in using your GenomeSpace OpenID, and the tool will use this ID if no token is entered.
This allows you to simply paste the filepath into the location box and leave the token empty. 
You can associate your OpenID credentials under the User Preferences panel.
Click here_ to refresh your GenomeSpace token.
  
.. _here:  ${static_path}/../user/openid_auth?openid_provider=genomespace&amp;auto_associate=True
    </help>
    <options refresh="True"/>
</tool>
