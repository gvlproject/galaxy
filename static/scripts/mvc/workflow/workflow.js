define(["utils/utils","mvc/ui/ui-misc"],function(a,b){function c(){var c=this.$(".response-message"),d={};d={status:a.getQueryString("status"),message:_.escape(a.getQueryString("message")),persistent:!0,cls:a.getQueryString("status")+"message"},c.empty().html(new b.Message(d).$el)}var d=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.render()},render:function(){var a=this,b=3;$.getJSON(Galaxy.root+"api/workflows/",function(d){var e=null;a.$el.empty().append(a._templateHeader()),c(),e=a.$(".user-workflows"),e.append(a._templateActionButtons()),d.length>0?(e.append(a._templateWorkflowTable(a,d)),a.adjust_actiondropdown(e),_.each(d,function(b){a.confirm_delete(b)}),a.register_show_tool_menu(),a.search_workflow(a.$(".search-wf"),a.$(".workflow-search tr"),b)):e.append(a._templateNoWorkflow())})},register_show_tool_menu:function(){var a=this.$(".show-in-tool-panel");a.on("click",function(){for(var b=[],c=0;c<a.length;c++){var d=a[c];d.checked&&b.push(d.value)}$.ajax({type:"PUT",url:Galaxy.root+"api/workflows/menu/",data:JSON.stringify({workflow_ids:b}),contentType:"application/json"}).done(function(){window.location=Galaxy.root+"workflow"})})},confirm_delete:function(a){var b=this.$(".link-confirm-"+a.id),c=this.$(".link-confirm-shared-"+a.id);b.click(function(){return confirm("Are you sure you want to delete workflow '"+a.name+"'?")}),c.click(function(){return confirm("Are you sure you want to remove the shared workflow '"+a.name+"'?")})},search_workflow:function(a,b,c){a.on("keyup",function(){var a=$(this).val();if(a.length>=c){var d=new RegExp(a,"i");b.hide(),b.filter(function(){return d.test($(this).text())}).show()}else b.show()})},adjust_actiondropdown:function(a){a.on("show.bs.dropdown",function(){a.css("overflow","inherit")}),a.on("hide.bs.dropdown",function(){a.css("overflow","auto")})},_templateNoWorkflow:function(){return'<div class="wf-nodata"> You have no workflows. </div>'},_templateActionButtons:function(){return'<ul class="manage-table-actions"><li><input class="search-wf form-control" type="text" autocomplete="off" placeholder="search for workflow..."></li><li><a class="action-button fa fa-plus wf-action" id="new-workflow" title="Create new workflow" href="'+Galaxy.root+'workflow/create"></a></li><li><a class="action-button fa fa-upload wf-action" id="import-workflow" title="Upload or import workflow" href="'+Galaxy.root+'workflow/import_workflow"></a></li></ul>'},_templateWorkflowTable:function(a,b){var c="",d="";return c+='<table class="table colored"><thead><tr class="header"><th>Name</th><th>Owner</th><th># of Steps</th><th>Published</th><th>Show in tools panel</th></tr></thead>',_.each(b,function(b){var c='<input type="checkbox" class="show-in-tool-panel" '+(b.show_in_tool_panel?'checked="'+b.show_in_tool_panel+'"':"")+' value="'+b.id+'">';d=d+'<tr><td><div class="dropdown"><button class="menubutton" type="button" data-toggle="dropdown">'+_.escape(b.name)+'<span class="caret"></span></button>'+a._templateActions(b)+"</div></td><td>"+(b.owner===Galaxy.user.attributes.username?"You":b.owner)+"</td><td>"+b.number_of_steps+"</td><td>"+(b.published?"Yes":"No")+"</td><td>"+c+"</td></tr>"}),c+'<tbody class="workflow-search">'+d+"</tbody></table>"},_templateActions:function(a){return a.owner===Galaxy.user.attributes.username?'<ul class="dropdown-menu action-dpd"><li><a href="'+Galaxy.root+"workflow/editor?id="+a.id+'">Edit</a></li><li><a href="'+Galaxy.root+"workflow/run?id="+a.id+'">Run</a></li><li><a href="'+Galaxy.root+"workflow/sharing?id="+a.id+'">Share or Download</a></li><li><a href="'+Galaxy.root+"workflow/copy?id="+a.id+'">Copy</a></li><li><a href="'+Galaxy.root+"workflow/rename?id="+a.id+'">Rename</a></li><li><a href="'+Galaxy.root+"workflow/display_by_id?id="+a.id+'">View</a></li><li><a class="link-confirm-'+a.id+'" href="'+Galaxy.root+"workflow/delete?id="+a.id+'">Delete</a></li></ul>':'<ul class="dropdown-menu action-dpd"><li><a href="'+Galaxy.root+"workflow/display_by_username_and_slug?username="+a.owner+"&slug="+a.slug+'">View</a></li><li><a href="'+Galaxy.root+"workflow/run?id="+a.id+'">Run</a></li><li><a href="'+Galaxy.root+"workflow/copy?id="+a.id+'">Copy</a></li><li><a class="link-confirm-shared-'+a.id+'" href="'+Galaxy.root+"workflow/sharing?unshare_me=True&id="+a.id+'">Remove</a></li></ul>'},_templateHeader:function(){return'<div class="page-container"><div class="user-workflows wf"><div class="response-message"></div><h2>Your workflows</h2></div></div>'}}),e=Backbone.View.extend({initialize:function(){this.setElement("<div/>"),this.render()},render:function(){var a=this;$.getJSON(Galaxy.root+"workflow/upload_import_workflow",function(b){a.$el.empty().append(a._mainTemplate(b))})},_mainTemplate:function(a){return"<div class='toolForm'><div class='toolFormTitle'>Import Galaxy workflow</div><div class='toolFormBody'><form name='import_workflow' id='import_workflow' action='"+Galaxy.root+"workflow/upload_import_workflow' enctype='multipart/form-data' method='POST'><div class='form-row'><label>Galaxy workflow URL:</label><input type='text' name='url' class='input-url' value='"+a.url+"' size='40'><div class='toolParamHelp' style='clear: both;'>If the workflow is accessible via a URL, enter the URL above and click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><label>Galaxy workflow file:</label><div class='form-row-input'><input type='file' name='file_data' class='input-file'/></div><div class='toolParamHelp' style='clear: both;'>If the workflow is in a file on your computer, choose it and then click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><input type='submit' class='primary-button wf-import' name='import_button' value='Import'></div></form><hr/><div class='form-row'><label>Import a Galaxy workflow from myExperiment:</label><div class='form-row-input'><a href='"+a.myexperiment_target_url+"'> Visit myExperiment</a></div><div class='toolParamHelp' style='clear: both;'>Click the link above to visit myExperiment and browse for Galaxy workflows.</div><div style='clear: both'></div></div></div></div>"}});return{View:d,ImportWorkflowView:e}});
//# sourceMappingURL=../../../maps/mvc/workflow/workflow.js.map